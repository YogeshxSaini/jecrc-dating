(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{4926:function(e,t,s){Promise.resolve().then(s.bind(s,1925))},1925:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var r=s(7437),l=s(2265),n=s(4033),a=s(4337);let i=(0,l.createContext)(null),c=()=>{let e=(0,l.useContext)(i);if(!e)throw Error("useMessaging must be used within MessagingProvider");return e},o=e=>{let{children:t}=e,[s,n]=(0,l.useState)(null),[c,o]=(0,l.useState)("disconnected"),[d,u]=(0,l.useState)([]),[m,h]=(0,l.useState)([]),[x,f]=(0,l.useState)({}),g=(0,l.useRef)(),p=(0,l.useRef)(0),j=(0,l.useRef)(new Set),v=(0,l.useRef)(new Set),b=(0,l.useRef)(new Set),y=e=>Math.min(1e3*Math.pow(2,e),3e4),N=(0,l.useCallback)(()=>{let e=localStorage.getItem("accessToken");if(!e){console.log("No access token, skipping socket connection");return}e.startsWith("Bearer ")&&(e=e.slice(7));let t=["localhost","127.0.0.1","[::1]","0.0.0.0"].includes(window.location.hostname)?"http://localhost:4000":"https://jecrc-dating-backend.onrender.com";console.log("Initializing socket connection to:",t),o("connecting");let s=(0,a.io)(t,{auth:{token:e},transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:3e4,reconnectionAttempts:1/0,timeout:6e4});return s.on("connect",()=>{console.log("Socket connected:",s.id),o("connected"),p.current=0,g.current&&clearTimeout(g.current)}),s.on("disconnect",e=>{console.log("Socket disconnected:",e),o("disconnected")}),s.on("connect_error",e=>{console.error("Socket connection error:",e),o("reconnecting"),p.current++;let t=y(p.current);console.log("Reconnecting in ".concat(t,"ms (attempt ").concat(p.current,")")),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{s.disconnected&&(console.log("Attempting reconnection..."),s.connect())},t)}),s.on("new_message",e=>{console.log("Received new message:",e),u(t=>[...t,e]),j.current.forEach(t=>t(e))}),s.on("message_read",e=>{console.log("Message read:",e),u(t=>t.map(t=>t.matchId!==e.matchId||t.readAt?t:{...t,readAt:e.readAt})),b.current.forEach(t=>t(e))}),s.on("message_delivered",e=>{console.log("Message delivered:",e),u(t=>t.map(t=>t.matchId!==e.matchId||t.deliveredAt?t:{...t,deliveredAt:e.deliveredAt}))}),s.on("user_typing",e=>{console.log("User typing:",e),h(t=>t.find(t=>t.matchId===e.matchId&&t.userId===e.userId)?t:[...t,e]),v.current.forEach(t=>t(e))}),s.on("user_stopped_typing",e=>{console.log("User stopped typing:",e),h(t=>t.filter(t=>!(t.matchId===e.matchId&&t.userId===e.userId)))}),s.on("user_online",e=>{console.log("User online:",e),f(t=>({...t,[e.userId]:!0}))}),s.on("user_offline",e=>{console.log("User offline:",e),f(t=>({...t,[e.userId]:!1}))}),n(s),()=>{console.log("Cleaning up socket connection"),g.current&&clearTimeout(g.current),s.close()}},[]);(0,l.useEffect)(()=>N(),[N]);let w=(0,l.useCallback)((e,t)=>{if(!s||!s.connected){console.error("Socket not connected, cannot send message");return}s.emit("send_message",{matchId:e,content:t},e=>{(null==e?void 0:e.error)?console.error("Error sending message:",e.error):console.log("Message sent successfully:",e)})},[s]),k=(0,l.useCallback)(e=>{if(!s||!s.connected){console.error("Socket not connected, cannot mark as read");return}s.emit("mark_as_read",{matchId:e})},[s]),D=(0,l.useCallback)(e=>{s&&s.connected&&s.emit("typing",{matchId:e})},[s]),I=(0,l.useCallback)(e=>{s&&s.connected&&s.emit("stop_typing",{matchId:e})},[s]),C=(0,l.useCallback)(e=>(j.current.add(e),()=>{j.current.delete(e)}),[]),S=(0,l.useCallback)(e=>(v.current.add(e),()=>{v.current.delete(e)}),[]),A=(0,l.useCallback)(e=>(b.current.add(e),()=>{b.current.delete(e)}),[]);return(0,r.jsx)(i.Provider,{value:{socket:s,connectionStatus:c,messages:d,typingUsers:m,onlineStatus:x,sendMessage:w,markAsRead:k,startTyping:D,stopTyping:I,addMessageListener:C,addTypingListener:S,addReadReceiptListener:A},children:t})},d=e=>{let{onSelectChat:t,selectedMatchId:s}=e,[n,a]=(0,l.useState)([]),[i,o]=(0,l.useState)(!0),[d,u]=(0,l.useState)(null),{connectionStatus:m,onlineStatus:h,addMessageListener:x}=c();(0,l.useEffect)(()=>{f()},[]),(0,l.useEffect)(()=>x(e=>{a(t=>t.map(t=>{if(t.matchId===e.matchId){var s,r;return{...t,lastMessage:{id:e.id,content:e.content,senderId:e.senderId,createdAt:e.createdAt,sender:{displayName:(null===(s=e.sender)||void 0===s?void 0:s.displayName)||(null===(r=e.sender)||void 0===r?void 0:r.name)||"User"}},unreadCount:e.senderId!==t.user.id?t.unreadCount+1:t.unreadCount}}return t}))}),[x]);let f=async()=>{try{o(!0);let e=localStorage.getItem("accessToken"),t=["localhost","127.0.0.1","[::1]","0.0.0.0"].includes(window.location.hostname),s=(null==e?void 0:e.startsWith("Bearer "))?e:"Bearer ".concat(e),r=await fetch("".concat(t?"http://localhost:4000":"https://jecrc-dating-backend.onrender.com","/api/messages/matches"),{headers:{Authorization:s}}),l=await r.json();l.success?a(l.matches):u(l.error||"Failed to fetch matches")}catch(e){console.error("Error fetching matches:",e),u("Failed to load conversations")}finally{o(!1)}},g=e=>{let t=new Date(e),s=new Date().getTime()-t.getTime(),r=Math.floor(s/6e4),l=Math.floor(s/36e5),n=Math.floor(s/864e5);return r<1?"Just now":r<60?"".concat(r,"m"):l<24?"".concat(l,"h"):n<7?"".concat(n,"d"):t.toLocaleDateString()},p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e.length<=t?e:e.substring(0,t)+"..."};return i?(0,r.jsx)("div",{className:"flex flex-col h-full bg-white border-r",children:(0,r.jsx)("div",{className:"flex items-center justify-center flex-1",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"})})}):d?(0,r.jsx)("div",{className:"flex flex-col h-full bg-white border-r",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1 p-4",children:[(0,r.jsx)("p",{className:"text-red-500 text-center",children:d}),(0,r.jsx)("button",{onClick:f,className:"mt-4 px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600",children:"Retry"})]})}):(0,r.jsxs)("div",{className:"flex flex-col h-full bg-white border-r",children:["connected"!==m&&(0,r.jsx)("div",{className:"px-4 py-2 bg-yellow-50 border-b",children:(0,r.jsxs)("div",{className:"text-xs text-gray-600",children:["connecting"===m&&"\uD83D\uDFE1 Connecting...","reconnecting"===m&&"\uD83D\uDFE0 Reconnecting...","disconnected"===m&&"\uD83D\uDD34 Disconnected"]})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",style:{mixBlendMode:"normal",filter:"none"},children:0===n.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-4 text-center",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"No matches yet"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Start swiping to find your match!"})]}):n.map(e=>{let l=h[e.user.id]||!1,n=s===e.matchId;return(0,r.jsx)("div",{onClick:()=>t(e.matchId,e.user),className:"p-4 border-b cursor-pointer transition-colors ".concat(n?"bg-pink-50":"hover:bg-gray-50"),children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,r.jsx)("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white font-bold text-xl overflow-hidden",children:e.user.profileImage?(0,r.jsx)("img",{src:e.user.profileImage,alt:e.user.displayName,className:"w-full h-full object-cover"}):e.user.displayName.charAt(0).toUpperCase()}),l&&(0,r.jsx)("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:e.user.displayName}),e.lastMessage&&(0,r.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:g(e.lastMessage.createdAt)})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:e.user.department&&e.user.year&&(0,r.jsxs)("span",{children:[e.user.department," • Year ",e.user.year]})}),e.lastMessage?(0,r.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 truncate",children:p(e.lastMessage.content)}),e.unreadCount>0&&(0,r.jsx)("span",{className:"flex-shrink-0 ml-2 bg-pink-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:e.unreadCount>9?"9+":e.unreadCount})]}):(0,r.jsx)("p",{className:"text-sm text-gray-400 italic mt-1",children:"Start a conversation..."})]})]})},e.matchId)})})]})},u=e=>{let{onSendMessage:t,matchId:s}=e,[n,a]=(0,l.useState)(""),[i,o]=(0,l.useState)(!1),[d,u]=(0,l.useState)(!1),m=(0,l.useRef)(null),h=(0,l.useRef)(),x=(0,l.useRef)(null),{startTyping:f,stopTyping:g,connectionStatus:p}=c();(0,l.useEffect)(()=>{m.current&&(m.current.style.height="auto",m.current.style.height=m.current.scrollHeight+"px")},[n]),(0,l.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&u(!1)};return d&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[d]);let j=e=>{e.preventDefault();let r=n.trim();r&&(i&&(o(!1),g(s)),h.current&&clearTimeout(h.current),t(r),a(""),m.current&&(m.current.style.height="auto"))},v=e=>{var t;a(t=>t+e),u(!1),null===(t=m.current)||void 0===t||t.focus()},b="connected"!==p;return(0,r.jsxs)("div",{className:"bg-white border-t p-4",children:[(0,r.jsxs)("form",{onSubmit:j,className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 relative flex items-center",ref:x,children:[(0,r.jsx)("textarea",{ref:m,value:n,onChange:e=>{a(e.target.value),e.target.value.trim()&&!i&&(o(!0),f(s)),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{i&&(o(!1),g(s))},2e3)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),j(e))},placeholder:b?"Connecting...":"Type a message...",disabled:b,className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-full resize-none focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed max-h-32 scrollbar-hide",rows:1,style:{minHeight:"48px",color:"#000",WebkitTextFillColor:"#000"}}),d&&(0,r.jsx)("div",{className:"absolute bottom-full right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 p-3 w-64 z-10",children:(0,r.jsx)("div",{className:"grid grid-cols-5 gap-2",children:["\uD83D\uDE0A","\uD83D\uDE02","❤️","\uD83D\uDC4D","\uD83C\uDF89","\uD83D\uDE0D","\uD83D\uDD25","\uD83D\uDC4F","\uD83D\uDE22","\uD83D\uDE4F","\uD83D\uDCAF","✨","\uD83C\uDF8A","\uD83E\uDD70","\uD83D\uDE0E","\uD83E\uDD17","\uD83D\uDE18","\uD83D\uDC95","\uD83C\uDF1F","\uD83D\uDC96"].map((e,t)=>(0,r.jsx)("button",{type:"button",onClick:()=>v(e),className:"text-2xl hover:bg-gray-100 rounded p-2 transition-colors",children:e},t))})}),(0,r.jsx)("button",{type:"button",onClick:()=>u(!d),className:"absolute right-3 text-gray-400 hover:text-gray-600 transition-colors",disabled:b,style:{top:"50%",transform:"translateY(-50%)"},children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),(0,r.jsx)("button",{type:"submit",disabled:!n.trim()||b,className:"flex-shrink-0 w-12 h-12 bg-gradient-to-br from-pink-500 to-purple-500 text-white rounded-full flex items-center justify-center hover:from-pink-600 hover:to-purple-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:from-pink-500 disabled:hover:to-purple-500",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]}),b&&(0,r.jsxs)("div",{className:"text-xs text-center text-orange-500 pt-2",children:["connecting"===p&&"Connecting to server...","reconnecting"===p&&"Reconnecting...","disconnected"===p&&"Disconnected. Messages will be sent when reconnected."]})]})},m=e=>{let{matchId:t,user:s,currentUserId:n}=e,[a,i]=(0,l.useState)([]),[o,d]=(0,l.useState)(!0),[m,h]=(0,l.useState)(null),[x,f]=(0,l.useState)(!1),[g,p]=(0,l.useState)(null),j=(0,l.useRef)(null),v=(0,l.useRef)(null),{sendMessage:b,markAsRead:y,addMessageListener:N,addTypingListener:w,typingUsers:k,onlineStatus:D}=c();(0,l.useEffect)(()=>{S(),y(t)},[t]),(0,l.useEffect)(()=>N(e=>{e.matchId===t&&(i(t=>{var r,l,n,a,i;if(t.find(t=>t.id===e.id))return t;let c=e.senderId===s.id?s.profileImage:null!==(i=null===(r=e.sender)||void 0===r?void 0:r.profileImage)&&void 0!==i?i:null;return[...t,{id:e.id,matchId:e.matchId,senderId:e.senderId,content:e.content,readAt:e.readAt,deliveredAt:e.deliveredAt,createdAt:e.createdAt,sender:{id:(null===(l=e.sender)||void 0===l?void 0:l.id)||e.senderId,displayName:(null===(n=e.sender)||void 0===n?void 0:n.displayName)||(null===(a=e.sender)||void 0===a?void 0:a.name)||s.displayName,profileImage:c}}]}),setTimeout(()=>y(t),100))}),[t,N,y,s]);let I=D[s.id]||!1,C=k.some(e=>e.matchId===t&&e.userId===s.id);(0,l.useEffect)(()=>{A()},[a,C]);let S=async()=>{try{d(!0),h(null);let e=localStorage.getItem("accessToken"),s=["localhost","127.0.0.1","[::1]","0.0.0.0"].includes(window.location.hostname),r=(null==e?void 0:e.startsWith("Bearer "))?e:"Bearer ".concat(e),l=await fetch("".concat(s?"http://localhost:4000":"https://jecrc-dating-backend.onrender.com","/api/messages/").concat(t),{headers:{Authorization:r}}),n=await l.json();if(n.success){let e=n.messages.map(e=>{var t;return{id:e.id,matchId:e.matchId,senderId:e.senderId,content:e.content,readAt:e.readAt,deliveredAt:e.deliveredAt,createdAt:e.createdAt,sender:{id:e.sender.id,displayName:e.sender.displayName,profileImage:null!==(t=e.sender.profileImage)&&void 0!==t?t:null}}});i(e),f(n.hasMore)}else h(n.error||"Failed to fetch messages")}catch(e){console.error("Error fetching messages:",e),h("Failed to load messages")}finally{d(!1)}},A=()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},E=e=>{let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/864e5);return 0===s?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):1===s?"Yesterday "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s<7?t.toLocaleDateString([],{weekday:"short"})+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric"})+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return o?(0,r.jsxs)("div",{className:"flex flex-col h-full w-full bg-gray-50",children:[(0,r.jsxs)("div",{className:"bg-white border-b p-4 flex items-center gap-3",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white font-bold overflow-hidden",children:s.profileImage?(0,r.jsx)("img",{src:s.profileImage,alt:s.displayName,className:"w-full h-full object-cover"}):s.displayName.charAt(0).toUpperCase()})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900",children:s.displayName}),s.department&&s.year&&(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[s.department," • Year ",s.year]})]})]}),(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"})})]}):m?(0,r.jsxs)("div",{className:"flex flex-col h-full w-full bg-gray-50",children:[(0,r.jsxs)("div",{className:"bg-white border-b p-4 flex items-center gap-3",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white font-bold overflow-hidden",children:s.profileImage?(0,r.jsx)("img",{src:s.profileImage,alt:s.displayName,className:"w-full h-full object-cover"}):s.displayName.charAt(0).toUpperCase()})}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("h2",{className:"font-semibold text-gray-900",children:s.displayName})})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center p-4",children:[(0,r.jsx)("p",{className:"text-red-500 text-center",children:m}),(0,r.jsx)("button",{onClick:S,className:"mt-4 px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600",children:"Retry"})]})]}):(0,r.jsxs)("div",{className:"flex flex-col h-full w-full bg-gray-50",children:[(0,r.jsxs)("div",{className:"bg-white border-b p-4 flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white font-bold overflow-hidden",children:s.profileImage?(0,r.jsx)("img",{src:s.profileImage,alt:s.displayName,className:"w-full h-full object-cover"}):s.displayName.charAt(0).toUpperCase()}),I&&(0,r.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-900",children:s.displayName}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[I?(0,r.jsx)("span",{className:"text-green-600",children:"Online"}):(0,r.jsx)("span",{children:"Offline"}),s.department&&s.year&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:"•"}),(0,r.jsxs)("span",{children:[s.department," • Year ",s.year]})]})]})]})]}),(0,r.jsx)("div",{ref:v,className:"flex-1 overflow-y-auto p-4 space-y-1",children:0===a.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[(0,r.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white text-3xl mb-4",children:"\uD83D\uDCAC"}),(0,r.jsx)("p",{className:"text-gray-500 font-medium",children:"No messages yet"}),(0,r.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["Say hi to ",s.displayName," to start the conversation!"]})]}):(0,r.jsxs)(r.Fragment,{children:[a.map((e,t)=>{let s=e.senderId===n,l=0===t||a[t-1].senderId!==e.senderId;return(0,r.jsxs)("div",{className:"flex ".concat(s?"justify-end":"justify-start"," gap-2 ").concat(l?"mt-3":"mt-0.5"),children:[!s&&l&&(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white text-sm font-bold overflow-hidden flex-shrink-0",children:e.sender.profileImage?(0,r.jsx)("img",{src:e.sender.profileImage,alt:e.sender.displayName,className:"w-full h-full object-cover"}):e.sender.displayName.charAt(0).toUpperCase()}),!s&&!l&&(0,r.jsx)("div",{className:"w-8"}),(0,r.jsxs)("div",{className:"max-w-[70%] ".concat(s?"items-end":"items-start"),children:[(0,r.jsx)("div",{className:"rounded-2xl px-4 py-2 ".concat(s?"bg-gradient-to-br from-pink-500 to-purple-500 text-white":"bg-white text-gray-900"),children:(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.content})}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1 px-2",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:E(e.createdAt)}),s&&(0,r.jsx)("span",{className:"text-xs cursor-pointer hover:opacity-70 transition-opacity",onClick:()=>p(e.id),children:e.readAt?(0,r.jsx)("span",{className:"text-blue-500",children:"✓✓"}):e.deliveredAt?(0,r.jsx)("span",{className:"text-gray-500",children:"✓✓"}):(0,r.jsx)("span",{className:"text-gray-400",children:"✓"})})]})]})]},e.id)}),C&&(0,r.jsxs)("div",{className:"flex justify-start gap-2 mt-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white text-sm font-bold overflow-hidden flex-shrink-0",children:s.profileImage?(0,r.jsx)("img",{src:s.profileImage,alt:s.displayName,className:"w-full h-full object-cover"}):s.displayName.charAt(0).toUpperCase()}),(0,r.jsx)("div",{className:"bg-white rounded-2xl px-4 py-2",children:(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,r.jsx)("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]}),(0,r.jsx)("div",{ref:j})]})}),(0,r.jsx)(u,{onSendMessage:e=>{b(t,e)},matchId:t}),g&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>p(null),children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full mx-4",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("h3",{className:"font-semibold text-lg mb-4 text-gray-900",children:"Message Info"}),(()=>{let e=a.find(e=>e.id===g);if(!e)return null;let t=e.deliveredAt||e.readAt;return(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[!t&&(0,r.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Message not yet delivered"}),e.deliveredAt&&(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("span",{className:"text-gray-500 mt-1",children:"✓✓"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-gray-600 font-medium",children:"Delivered"}),(0,r.jsx)("div",{className:"text-gray-900",children:E(e.deliveredAt)})]})]}),e.readAt&&(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("span",{className:"text-blue-500 mt-1",children:"✓✓"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-gray-600 font-medium",children:"Read"}),(0,r.jsx)("div",{className:"text-gray-900",children:E(e.readAt)})]})]})]})})(),(0,r.jsx)("button",{onClick:()=>p(null),className:"mt-6 w-full py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors font-medium text-gray-700",children:"Close"})]})})]})},h=()=>{let[e,t]=(0,l.useState)(null),[s,a]=(0,l.useState)(null),[i,c]=(0,l.useState)(null),o=(0,n.useRouter)();return(0,l.useEffect)(()=>{let e=localStorage.getItem("accessToken");if(!e){o.push("/login");return}try{let t=JSON.parse(atob(e.split(".")[1]));c(t.id)}catch(e){console.error("Error decoding token:",e)}},[o]),(0,r.jsxs)("div",{className:"flex w-full h-screen bg-gray-100 overflow-hidden",children:[(0,r.jsxs)("div",{className:"w-full md:w-96 flex-shrink-0 h-full overflow-hidden flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-white border-b",children:[(0,r.jsx)("button",{onClick:()=>{o.back()},className:"flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Go back",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Messages"})]}),(0,r.jsx)(d,{onSelectChat:(e,s)=>{t(e),a(s)},selectedMatchId:e})]}),(0,r.jsx)("div",{className:"flex-1 hidden md:flex h-full overflow-hidden",children:e&&s?(0,r.jsx)(m,{matchId:e,user:s,currentUserId:i||void 0}):(0,r.jsx)("div",{className:"flex flex-col items-center justify-center w-full bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center max-w-md px-4",children:[(0,r.jsx)("div",{className:"w-32 h-32 mx-auto mb-6 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white text-6xl",children:"\uD83D\uDCAC"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Select a conversation"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Choose a match from the list to start chatting"})]})})}),e&&s&&(0,r.jsxs)("div",{className:"fixed inset-0 z-50 bg-white md:hidden",children:[(0,r.jsxs)("div",{className:"flex items-center p-4 border-b bg-white",children:[(0,r.jsx)("button",{onClick:()=>{t(null),a(null)},className:"mr-3 text-gray-600 hover:text-gray-900",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,r.jsx)("h1",{className:"text-lg font-semibold",children:"Back to conversations"})]}),(0,r.jsx)("div",{className:"h-[calc(100vh-64px)]",children:(0,r.jsx)(m,{matchId:e,user:s,currentUserId:i||void 0})})]})]})};function x(){return(0,r.jsx)(o,{children:(0,r.jsx)(h,{})})}}},function(e){e.O(0,[532,971,458,744],function(){return e(e.s=4926)}),_N_E=e.O()}]);