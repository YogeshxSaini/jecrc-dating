(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7754:function(e,n,o){Promise.resolve().then(o.t.bind(o,9646,23)),Promise.resolve().then(o.t.bind(o,3385,23)),Promise.resolve().then(o.bind(o,4478))},4478:function(e,n,o){"use strict";o.r(n),o.d(n,{TokenRefreshProvider:function(){return d}});var t=o(7437),r=o(2265),a=o(7871);function l(e){e.storageArea&&("accessToken"===e.key&&(e.newValue&&e.newValue!==e.oldValue?(console.log("[CrossTabSync] Access token updated in another tab, syncing locally"),localStorage.getItem("tokenExpiry")):!e.newValue&&e.oldValue&&(console.log("[CrossTabSync] Access token cleared in another tab, logging out locally"),i())),"tokenExpiry"===e.key&&e.newValue&&(e.newValue,e.oldValue),"refreshToken"===e.key&&!e.newValue&&e.oldValue&&(console.log("[CrossTabSync] Refresh token cleared in another tab, logging out locally"),i()))}function i(){console.log("[CrossTabSync] Handling logout from another tab"),(0,a.yE)("Logout from another tab"),window.location.pathname.includes("/login")||(console.log("[CrossTabSync] Redirecting to login page"),window.location.href="/login")}let c=null,s=null,u=null,f=null;function g(){if("undefined"!=typeof document){if(document.hidden){let e=(0,a.UK)();e&&(clearTimeout(e),(0,a.QD)(null)),u&&u()}else{if(!localStorage.getItem("accessToken"))return;f&&f(),s?s():(0,a.Wm)()}}}let d=e=>{let{children:n}=e;return(0,r.useEffect)(()=>((0,a.j2)(),(0,a.Wm)(),console.log("[CrossTabSync] Initializing cross-tab synchronization"),window.addEventListener("storage",l),"undefined"!=typeof document&&(s=null,u=null,f=null,c&&document.removeEventListener("visibilitychange",c),c=g,document.addEventListener("visibilitychange",c),console.log("[BackgroundOptimization] Background tab optimization initialized"),document.hidden),()=>{window.removeEventListener("storage",l),"undefined"!=typeof document&&(c&&(document.removeEventListener("visibilitychange",c),c=null),s=null,u=null,f=null,console.log("[BackgroundOptimization] Background tab optimization cleaned up"))}),[]),(0,t.jsx)(t.Fragment,{children:n})}},7871:function(e,n,o){"use strict";o.d(n,{JW:function(){return l},L4:function(){return m},Ls:function(){return p},N7:function(){return f},QD:function(){return k},UK:function(){return d},Wm:function(){return function e(){r&&(clearTimeout(r),r=null);let n=i();if(!n)return;let o=new Date,t=n.getTime()-o.getTime()-12e4;if(t<=0){console.log("[TokenManager] Token already needs refresh, triggering immediately"),p().catch(e=>{console.error("[TokenManager] Immediate refresh failed:",e)});return}console.log("[TokenManager] Scheduling proactive refresh in ".concat(Math.floor(t/1e3/60),"m ").concat(Math.floor(t/1e3%60),"s")),r=setTimeout(()=>{console.log("[TokenManager] Proactive refresh triggered by schedule"),p().then(n=>{n&&e()}).catch(e=>{console.error("[TokenManager] Scheduled refresh failed:",e)})},t)}},dV:function(){return c},j2:function(){return T},km:function(){return s},x7:function(){return h},yE:function(){return u},yh:function(){return g}});let t=!1,r=null,a=Date.now();function l(e){try{let n=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(o)}catch(e){return console.error("[TokenManager] Failed to parse JWT:",e),null}}function i(){let e=localStorage.getItem("tokenExpiry");if(e){let n=new Date(e);if(!isNaN(n.getTime()))return n}let n=localStorage.getItem("accessToken");if(!n)return null;let o=l(n);return o&&o.exp?new Date(1e3*o.exp):(console.error("[TokenManager] Invalid token payload"),null)}function c(){let e=i();if(!e)return!1;let n=new Date;return e.getTime()-n.getTime()<12e4}function s(e){let n=l(e);if(!n||!n.exp){console.error("[TokenManager] Cannot store token: invalid payload");return}let o=new Date(1e3*n.exp);localStorage.setItem("accessToken",e),localStorage.setItem("tokenExpiry",o.toISOString()),console.log("[TokenManager] Token stored with expiry:",o.toISOString())}function u(e){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("tokenExpiry"),console.log("[TokenManager] Tokens cleared",e?"- Reason: ".concat(e):""),r&&(clearTimeout(r),r=null),t=!1}function f(){return t}function g(e){t=e}function d(){return r}function k(e){r&&clearTimeout(r),r=e}function m(){a=Date.now()}async function h(){if(!(Date.now()-a>3e5))return!0;if(console.log("[TokenManager] User inactive, validating token freshness"),!c())return m(),!0;console.log("[TokenManager] Token needs refresh after inactivity, refreshing"),t=!0;try{if(await p())return console.log("[TokenManager] Token refreshed successfully after inactivity"),m(),!0;return console.error("[TokenManager] Token refresh failed after inactivity"),!1}finally{t=!1}}function T(){console.log("[TokenManager] Initializing token manager"),m();let e=localStorage.getItem("accessToken");e&&(localStorage.getItem("tokenExpiry")||(console.log("[TokenManager] Token found without expiry, calculating and storing"),s(e)),c()&&console.log("[TokenManager] Token needs immediate refresh"),console.log("[TokenManager] Initialization complete"))}async function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=localStorage.getItem("refreshToken");if(!n)return console.error("[TokenManager] No refresh token available"),u("No refresh token available"),!1;try{let e=(await Promise.all([o.e(829),o.e(164)]).then(o.bind(o,6513))).default,{accessToken:t}=(await e.post("".concat("https://jecrc-dating-backend.onrender.com","/api/auth/refresh"),{refreshToken:n})).data;if(!t)return console.error("[TokenManager] Refresh response missing accessToken"),u("Invalid refresh response"),!1;return s(t),console.log("[TokenManager] Token refresh successful"),!0}catch(n){var t;if((null===(t=n.response)||void 0===t?void 0:t.status)===401)return console.error("[TokenManager] Refresh token invalid or expired (401)"),u("Refresh token invalid or expired"),!1;if((!n.response||[408,429,500,502,503,504].includes(n.response.status))&&e<2){let o=1e3*Math.pow(2,e);return console.warn("[TokenManager] Network error during refresh, retrying in ".concat(o,"ms (attempt ").concat(e+1,"/2)"),n.message),await new Promise(e=>setTimeout(e,o)),p(e+1)}return console.error("[TokenManager] Token refresh failed after ".concat(e+1," attempt(s)"),n.message),u("Token refresh failed"),!1}}},3385:function(){},9646:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}},622:function(e,n,o){"use strict";var t=o(2265),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function s(e,n,o){var t,a={},s=null,u=null;for(t in void 0!==o&&(s=""+o),void 0!==n.key&&(s=""+n.key),void 0!==n.ref&&(u=n.ref),n)l.call(n,t)&&!c.hasOwnProperty(t)&&(a[t]=n[t]);if(e&&e.defaultProps)for(t in n=e.defaultProps)void 0===a[t]&&(a[t]=n[t]);return{$$typeof:r,type:e,key:s,ref:u,props:a,_owner:i.current}}n.Fragment=a,n.jsx=s,n.jsxs=s},7437:function(e,n,o){"use strict";e.exports=o(622)}},function(e){e.O(0,[971,458,744],function(){return e(e.s=7754)}),_N_E=e.O()}]);