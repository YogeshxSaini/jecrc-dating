(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7754:function(e,n,o){Promise.resolve().then(o.t.bind(o,9646,23)),Promise.resolve().then(o.t.bind(o,3385,23)),Promise.resolve().then(o.bind(o,9404))},9404:function(e,n,o){"use strict";o.r(n),o.d(n,{TokenRefreshProvider:function(){return y}});var t=o(7437),r=o(2265);let a=null;function l(e){try{let n=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(o)}catch(e){return console.error("[TokenManager] Failed to parse JWT:",e),null}}function i(){let e=localStorage.getItem("tokenExpiry");if(e){let n=new Date(e);if(!isNaN(n.getTime()))return n}let n=localStorage.getItem("accessToken");if(!n)return null;let o=l(n);return o&&o.exp?new Date(1e3*o.exp):(console.error("[TokenManager] Invalid token payload"),null)}function s(e){let n=l(e);if(!n||!n.exp){console.error("[TokenManager] Cannot store token: invalid payload");return}let o=new Date(1e3*n.exp);localStorage.setItem("accessToken",e),localStorage.setItem("tokenExpiry",o.toISOString()),console.log("[TokenManager] Token stored with expiry:",o.toISOString())}function c(e){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("tokenExpiry"),console.log("[TokenManager] Tokens cleared",e?"- Reason: ".concat(e):""),a&&(clearTimeout(a),a=null)}async function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=localStorage.getItem("refreshToken");if(!n)return console.error("[TokenManager] No refresh token available"),c("No refresh token available"),!1;try{let e=(await Promise.all([o.e(829),o.e(164)]).then(o.bind(o,6513))).default,{accessToken:t}=(await e.post("".concat("https://jecrc-dating-backend.onrender.com","/api/auth/refresh"),{refreshToken:n})).data;if(!t)return console.error("[TokenManager] Refresh response missing accessToken"),c("Invalid refresh response"),!1;return s(t),console.log("[TokenManager] Token refresh successful"),!0}catch(n){var t;if((null===(t=n.response)||void 0===t?void 0:t.status)===401)return console.error("[TokenManager] Refresh token invalid or expired (401)"),c("Refresh token invalid or expired"),!1;if((!n.response||[408,429,500,502,503,504].includes(n.response.status))&&e<2){let o=1e3*Math.pow(2,e);return console.warn("[TokenManager] Network error during refresh, retrying in ".concat(o,"ms (attempt ").concat(e+1,"/2)"),n.message),await new Promise(e=>setTimeout(e,o)),u(e+1)}return console.error("[TokenManager] Token refresh failed after ".concat(e+1," attempt(s)"),n.message),c("Token refresh failed"),!1}}function g(){a&&(clearTimeout(a),a=null);let e=i();if(!e)return;let n=new Date,o=e.getTime()-n.getTime()-12e4;if(o<=0){console.log("[TokenManager] Token already needs refresh, triggering immediately"),u().catch(e=>{console.error("[TokenManager] Immediate refresh failed:",e)});return}console.log("[TokenManager] Scheduling proactive refresh in ".concat(Math.floor(o/1e3/60),"m ").concat(Math.floor(o/1e3%60),"s")),a=setTimeout(()=>{console.log("[TokenManager] Proactive refresh triggered by schedule"),u().then(e=>{e&&g()}).catch(e=>{console.error("[TokenManager] Scheduled refresh failed:",e)})},o)}function f(e){e.storageArea&&("accessToken"===e.key&&(e.newValue&&e.newValue!==e.oldValue?(console.log("[CrossTabSync] Access token updated in another tab, syncing locally"),localStorage.getItem("tokenExpiry")):!e.newValue&&e.oldValue&&(console.log("[CrossTabSync] Access token cleared in another tab, logging out locally"),d())),"tokenExpiry"===e.key&&e.newValue&&(e.newValue,e.oldValue),"refreshToken"===e.key&&!e.newValue&&e.oldValue&&(console.log("[CrossTabSync] Refresh token cleared in another tab, logging out locally"),d()))}function d(){console.log("[CrossTabSync] Handling logout from another tab"),c("Logout from another tab"),window.location.pathname.includes("/login")||(console.log("[CrossTabSync] Redirecting to login page"),window.location.href="/login")}Date.now();let m=null,k=null,p=null,h=null;function T(){if("undefined"!=typeof document){if(document.hidden){let e=a;e&&(clearTimeout(e),a&&clearTimeout(a),a=null),p&&p()}else{if(!localStorage.getItem("accessToken"))return;h&&h(),k?k():g()}}}let y=e=>{let{children:n}=e;return(0,r.useEffect)(()=>((function(){console.log("[TokenManager] Initializing token manager"),Date.now();let e=localStorage.getItem("accessToken");e&&(localStorage.getItem("tokenExpiry")||(console.log("[TokenManager] Token found without expiry, calculating and storing"),s(e)),function(){let e=i();if(!e)return!1;let n=new Date;return e.getTime()-n.getTime()<12e4}()&&console.log("[TokenManager] Token needs immediate refresh"),console.log("[TokenManager] Initialization complete"))})(),g(),console.log("[CrossTabSync] Initializing cross-tab synchronization"),window.addEventListener("storage",f),"undefined"!=typeof document&&(k=null,p=null,h=null,m&&document.removeEventListener("visibilitychange",m),m=T,document.addEventListener("visibilitychange",m),console.log("[BackgroundOptimization] Background tab optimization initialized"),document.hidden),()=>{window.removeEventListener("storage",f),"undefined"!=typeof document&&(m&&(document.removeEventListener("visibilitychange",m),m=null),k=null,p=null,h=null,console.log("[BackgroundOptimization] Background tab optimization cleaned up"))}),[]),(0,t.jsx)(t.Fragment,{children:n})}},3385:function(){},9646:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}},622:function(e,n,o){"use strict";var t=o(2265),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(e,n,o){var t,a={},c=null,u=null;for(t in void 0!==o&&(c=""+o),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(u=n.ref),n)l.call(n,t)&&!s.hasOwnProperty(t)&&(a[t]=n[t]);if(e&&e.defaultProps)for(t in n=e.defaultProps)void 0===a[t]&&(a[t]=n[t]);return{$$typeof:r,type:e,key:c,ref:u,props:a,_owner:i.current}}n.Fragment=a,n.jsx=c,n.jsxs=c},7437:function(e,n,o){"use strict";e.exports=o(622)}},function(e){e.O(0,[971,458,744],function(){return e(e.s=7754)}),_N_E=e.O()}]);